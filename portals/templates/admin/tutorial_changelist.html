{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<h2 class="mt-3 mb-4">Manage Tutorials</h2>

<!-- SUCCESS MESSAGES -->
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}
{% endif %}

<!-- ADD NEW TUTORIAL -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">Add New Tutorial</div>
    <div class="card-body">
        <form method="post" class="row g-3">
            {% csrf_token %}
            <div class="col-md-3"><label>Lesson</label><input type="text" class="form-control" name="new_lesson" required></div>
            <div class="col-md-2"><label>CPD Number</label><input type="text" class="form-control" name="new_cpd_number" required></div>
            <div class="col-md-2"><label>Unit Price</label><input type="number" step="0.01" class="form-control" name="new_unit_price" required></div>
            <div class="col-md-1"><label>Points</label><input type="number" class="form-control" name="new_points" required></div>
            <div class="col-md-2"><label>Presented By</label><input type="text" class="form-control" name="new_presented_by" required></div>
            <div class="col-md-2"><label>Contact Hours</label><input type="number" step="0.1" class="form-control" name="new_contact_hours" required></div>
            <div class="col-md-1 d-flex align-items-end">
                <div class="form-check"><input type="checkbox" class="form-check-input" name="new_paid"><label class="form-check-label">Paid</label></div>
            </div>
            <div class="col-12 text-end"><button type="submit" name="add_new" class="btn btn-success">Add Tutorial</button></div>
        </form>
    </div>
</div>

<!-- UPDATE EXISTING TUTORIALS -->
<form method="post">
    {% csrf_token %}
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th>User</th>
                <th>Lesson</th>
                <th>CPD</th>
                <th>Unit Price</th>
                <th>Points</th>
                <th>Presented By</th>
                <th>Contact Hours</th>
                <th>Paid</th>
            </tr>
        </thead>
        <tbody>
            {% for obj in tutorials %}
            <tr>
                <td>
                    <select class="form-select" name="user_{{ obj.id }}" required>
                        {% for u in users %}
                            <option value="{{ u.id }}" {% if u.id == obj.user.id %}selected{% endif %}>
                                {{ u.username }}
                            </option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" class="form-control" name="lesson_{{ obj.id }}" value="{{ obj.lesson }}"></td>
                <td><input type="text" class="form-control" name="cpd_{{ obj.id }}" value="{{ obj.cpd_number }}"></td>
                <td><input type="number" step="0.01" class="form-control" name="price_{{ obj.id }}" value="{{ obj.unit_price }}"></td>
                <td><input type="number" class="form-control" name="points_{{ obj.id }}" value="{{ obj.points }}"></td>
                <td><input type="text" class="form-control" name="presented_{{ obj.id }}" value="{{ obj.presented_by }}"></td>
                <td><input type="number" step="0.1" class="form-control" name="hours_{{ obj.id }}" value="{{ obj.contact_hours }}"></td>
                <td class="text-center"><input type="checkbox" class="form-check-input" name="paid_{{ obj.id }}" {% if obj.is_paid %}checked{% endif %}></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit" name="save_all" class="btn btn-primary mt-3">Save All Changes</button>
</form>

{% endblock %}

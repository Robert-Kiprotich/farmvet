{% extends 'portals/base.html' %}

{% load static %}

{% block content %}
{% include 'portals/sidebarVet.html' %}

<main class="page-content">
<div class="container-fluid">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent  bg-primary  navbar-absolute">
   
        <div class="container-fluid">
          <div class="navbar-wrapper">
            
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navigation">
            
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="#pablo">
                  <i class="now-ui-icons media-2_sound-wave"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Stats</span>
                  </p>
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="now-ui-icons location_world"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Some Actions</span>
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="#">Account Management</a>
                  <a class="dropdown-item" href="#">Profile picture</a>
                  <a class="dropdown-item" href="#">Change Password</a>
                  <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#pablo">
                  <i class="now-ui-icons users_single-02"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Account</span>
                  </p>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="panel-header panel-header-lg">
      </div>
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                                <h4 class="">Vet Dashboard</h4>
                                  <!-- Content Wrapper. Contains page content -->
      <div class="card-body">
        <div class="row">


          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-info">
              <div class="inner">
                <h3>150</h3>

                <p>New Orders</p>
              </div>
              <div class="icon">
                <i class="ion ion-bag"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <h3>53<sup style="font-size: 20px">%</sup></h3>

                <p>Bounce Rate</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-warning">
              <div class="inner">
                <h3>44</h3>

                <p>User Registrations</p>
              </div>
              <div class="icon">
                <i class="ion ion-person-add"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-danger">
              <div class="inner">
                <h3>65</h3>

                <p>Unique Visitors</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>


          
        
        <div class="card mb-4">
          <div class="card-header border-0">
            <h3 class="card-title">Statistics</h3>
            <div class="card-tools">
              <a href="#" class="btn btn-tool btn-sm"> <i class="bi bi-download"></i> </a>
              <a href="#" class="btn btn-tool btn-sm"> <i class="bi bi-list"></i> </a>
            </div>
          </div>
          <div class="card-body table-responsive p-0">
            <table class="table table-striped align-middle" >
              <thead>
                <tr>
                  <th>Records</th>
                  <th>Category</th>
                  <th>Query</th>
                  <th>From</th>
                  <th>To</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="recordsTable">
                
                <tr>
                  <td>
                    Artificial Insemination
                  </td>
                  <td>
                      <select class="form-control" id="animal_species" style="width: 150px;">
                        {% for value, display in ANIMAL_SPECIES %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>
                  </td>
              <td>
                <p></p>
              </td>
                  <td>
                    <input type="date" id="aidate_from" value="2020-01-01" class="form-control" style="width: 150px;">
                  </td>
                  <td>
                    <input type="date" id="aidate_to" value="2025-01-01" class="form-control" style="width: 150px;">  
                  </td>
                  <td>
                    <h2 id="aitotal">0</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    
                    Vaccination
                  </td>
                  <td>
                    <select id="species" class="form-control" style="width: 150px;">
                    {% for value, display in ANIMAL_SPECIES_CHOICES %}
                        <option value="{{ value }}">{{ display }}</option>
                    {% endfor %}
                </select>
                  </td>
                  <td>
                    <select id="vaccination_of" class="form-control" style="width: 150px;">
                    {% for value, display in DISEASE_CHOICES %}
                        <option value="{{ value }}">{{ display }}</option>
                    {% endfor %}
                </select>
                  </td>
                  <td>
                    <input type="date" id="date_from" value="2020-01-01" class="form-control" style="width: 150px;">
                  </td>
                  <td>
                    <input type="date" id="date_to" value="2025-01-01" class="form-control" style="width: 150px;">  
                  </td>
                  <td>
                      <h2 id="total">0</h2>
                </td>
                </tr>
                <tr>
                  <td>
                  Meat Inspection
                  </td>
                  <td>
                      <select class="form-control" id="category" style="width: 150px;">
                        {% for value, display in MEAT_CATEGORY_CHOICES %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>
                  </td>
              <td>
                <p></p>
              </td>
                  <td>
                    <input type="date" id="datekl_from" value="2020-01-01" class="form-control" style="width: 150px;">
                  </td>
                  <td>
                    <input type="date" id="datekl_to" value="2026-01-01" class="form-control" style="width: 150px;">  
                  </td>
                  <td>
                    <h2 id="cattotal">0</p>
                  </td>
                </tr>
                </tr> 
             
              </tbody>
            </table>
          </div>
        </div>
          <!-- right col -->
        </div>
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->
      </div>
      </div>
      </div>
      </div>
      </div>
      </main>
   
             
     
    
    
      <footer class="footer">
        <div class=" container-fluid ">
            <div class="copyright">
              &copy; Copyright <strong><span>SoinVet</span></strong>. All Rights Reserved
              <div class="credits">
               
            </div>
          </div>
        </footer><!-- End Footer -->
  <!--   Core JS Files   -->
 
 
  <script src="{% static 'portals/assets/js/core/jquery.min.js' %}"></script>
  <script src="{% static 'portals/assets/js/core/popper.min.js' %}"></script>
  <script src="{% static 'portals/assets/js/core/bootstrap.min.js' %}"></script>
 
 
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="{% static 'portals/assets/js/now-ui-dashboard.min.js' %}" type="text/javascript"></script><!-- Now Ui Dashboard DEMO methods, don't include it in your project! -->
  <script src="{% static 'portals/assets/js/main.js' %}"></script>
  
      <script src="{% static 'portals/assets/dist/js/adminlte.js' %}"></script>
     
      <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
      <script src="{% static 'portals/assets/dist/js/pages/dashboard.js' %}"></script>
      <!-- AdminLTE for demo purposes -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg.js" integrity="sha512-2B4yJ2DGhmYITzY51PcSK5pxQilqi1Cl3wgI8dq8phWjbVAw9SmcaTZp+QsSCdV/xKkxttyYolU0usNNG1ICbQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
      <script src="{% static 'portals/assets/dist/js/demo.js' %}"></script>
      
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const categoryDropdown = document.getElementById("category");
          const dateFromInputKL = document.getElementById("datekl_from");
          const dateToInputKL = document.getElementById("datekl_to");
          const totalElementKL = document.getElementById("cattotal");
          
          const today = new Date();
          const formattedDateKL = today.toISOString().split('T')[0];
          dateToInputKL.value = formattedDateKL;
      
          const apiUrl = "/kills_filter/"; // Replace with your actual API endpoint
          let fetchedDataKL = [];
         // console.log(fetchedData) 
      
          async function fetchData() {
              try {
                  const response = await fetch(apiUrl);
                  const data = await response.json(); // Parse the JSON response
                  fetchedDataKL.splice(0, fetchedDataKL.length, ...data.records || []);
                  console.log( fetchedDataKL)
                  filterData(); // Apply the filter immediately after data is fetched
              } catch (error) {
                  console.error("Error fetching data:", error);
              }
          }
      
          function filterData() {
              const selectedCategory = categoryDropdown.value;
              const dateFromKL = new Date(dateFromInputKL.value);
              const dateToKL = new Date(dateToInputKL.value);
      
              const filteredDataKL = fetchedDataKL.filter(record => {
                  const recordDateKL = new Date(record.date);
                  return (
                      (!selectedCategory || record.livestock_category === selectedCategory) &&
                      (!dateFromInputKL.value || recordDateKL >= dateFromKL) &&
                      (!dateToInputKL.value || recordDateKL <= dateToKL)
                  );
              });
              const totalKilled = filteredDataKL.reduce((sum, record) => {
                return sum + (record.total_kills_per_day || 0);
            }, 0);
    
            
           
              
      
              totalElementKL.textContent = totalKilled;
          }
      
          [categoryDropdown, dateFromInputKL, dateToInputKL].forEach(element => {
              element.addEventListener("change", filterData);
              //console.log(element.categoryDrodown)
          });
      
          fetchData();
      });
        
      </script>
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const speciesDropdownAI = document.getElementById("animal_species");
          const dateFromInputAI = document.getElementById("aidate_from");
          const dateToInputAI = document.getElementById("aidate_to");
          const totalElementAI = document.getElementById("aitotal");
          const today = new Date();
          const formattedDate = today.toISOString().split('T')[0];
          dateToInputAI.value = formattedDate;
          //console.log(speciesDropdownAI)
      
          const apiUrl = "/ai_filter/"; // Replace with your actual API endpoint
          let fetchedData = []; // Store fetched data for filtering
      
          async function fetchData() {
              try {
                  const response = await fetch(apiUrl);
                  const data = await response.json(); // Parse the JSON response
      
                  // Check if the response contains a `records` key
                  fetchedData.splice(0, fetchedData.length, ...data.records || []);
                 //console.log("user data:",data.user_records); // Use `records` array if it exists, otherwise fallback to an empty array
                  filterData(); // Apply the filter immediately after data is fetched
              } catch (error) {
                  console.error("Error fetching data:", error);
              }
          }
      
          function filterData() {
              // Get filter values
              const selectedSpeciesAI = speciesDropdownAI.value;
              const dateFromAI = new Date(dateFromInputAI.value);
              const dateToAI = new Date(dateToInputAI.value);
      
              // Filter data based on selected values and dates
              const filteredData = fetchedData.filter(record => {
                  const recordDate = new Date(record.insemination_date);
                  return (
                      (!selectedSpeciesAI || record.species === selectedSpeciesAI) &&
                      (!dateFromInputAI.value || recordDate >= dateFromAI) &&
                      (!dateToInputAI.value || recordDate <= dateToAI)
                  );
              });
      
              
              totalElementAI.textContent = filteredData.length;
      
             
              //console.log(filteredData);
          }
      
          [speciesDropdownAI,  dateFromInputAI, dateToInputAI].forEach(element => {
              element.addEventListener("change", filterData);
          });
      
          
          fetchData();
      });
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const speciesDropdown = document.getElementById("species");
      const vaccinationDropdown = document.getElementById("vaccination_of");
      const dateFromInput = document.getElementById("date_from");
      const dateToInput = document.getElementById("date_to");
      const totalElement = document.getElementById("total");
      const today = new Date();
      const formattedDate = today.toISOString().split('T')[0];
      dateToInput.value = formattedDate;
  
      const apiUrl = "/vaccination_filter/"; 
      let fetchedData = []; 
      console.log("fetch:",fetchedData)
  
      async function fetchData() {
          try {
              const response = await fetch(apiUrl);
              const data = await response.json();
              
              fetchedData.splice(0, fetchedData.length, ...data.records || []);
              filterData(); 
          } catch (error) {
              console.error("Error fetching data:", error);
          }
      }
  
      function filterData() {
          const selectedSpecies = speciesDropdown.value;
          const selectedVaccination = vaccinationDropdown.value;
          const dateFrom = new Date(dateFromInput.value);
          const dateTo = new Date(dateToInput.value);
  
          const filteredData = fetchedData.filter(record => {
              const recordDate = new Date(record.date_of_vaccination);
              return (
                  (!selectedSpecies || record.species_targeted === selectedSpecies) &&
                  (!selectedVaccination || record.vaccination_of === selectedVaccination) &&
                  (!dateFromInput.value || recordDate >= dateFrom) &&
                  (!dateToInput.value || recordDate <= dateTo)
              );
          });
  
          const totalVaccinated = filteredData.reduce((sum, record) => {
              return sum + (record.number_of_animals_vaccinated || 0);
          }, 0);
  
          totalElement.textContent = totalVaccinated;
      }
  
      [speciesDropdown, vaccinationDropdown, dateFromInput, dateToInput].forEach(element => {
          element.addEventListener("change", filterData);
      });
  
      fetchData();
  });
</script>  

      <script>
    
      $(document).ready(function() {
        // Javascript method's body can be found in assets/js/demos.js
        demo.initDashboardPageCharts();
      });
       

  </script>
 
</body>

{% endblock %}





